version: 2.1

jobs:
  test:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: |
            pip install pytest
      - run:
          name: Run Dynamic Tests and Summarize
          command: |
            pytest test_main.py -v --tb=short | tee pytest_output.txt
            echo "\n==================== DYNAMIC TEST SUMMARY ===================="
            TOTAL=$(grep -c 'def test_' test_main.py)
            PASSED=$(grep -c ' PASSED' pytest_output.txt)
            FAILED=$(grep -c ' FAILED' pytest_output.txt)
            echo "Number of test cases: $TOTAL"
            echo "Number of test cases passed: $PASSED"
            echo "Number of test cases failed: $FAILED"
            if [ "$FAILED" -eq 0 ]; then
              echo "Final Status: PASSED"
            else
              echo "Final Status: FAILED"
            fi

workflows:
  version: 2
  main:
    jobs:
      - test